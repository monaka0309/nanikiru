<!DOCTYPE html>
<html lang="ja">
<head>
    <style>
        /* PC表示時のみ適用されるスタイル */
        @media (min-width: 1024px) {
            .post-card {
                max-width: 65%;
                margin: 0 auto 1.5rem;
            }
        }
    </style>
</head>
<body class="bg-gray-200 font-sans leading-normal tracking-normal">
    <%= render 'layouts/header' %>
    <%= render 'layouts/sidebar' %>
    <main class="container mx-auto px-4 pt-8 text-gray-600 mb-10">
        <h1 class="text-3xl font-bold mb-10">投稿一覧</h1>

        <% if @posts.any? %>
            <div class="grid grid-cols-1">
                <% @posts.each do |post| %>
                <div class="bg-white rounded-lg shadow p-10 mb-4 post-card">
                    <%= link_to post_path(post) do %>
                
                    <p class="text-gray-700 mb-3" style="font-size: 14px;"><%= post.content %></p>

                        <% if post.image.present? %>
                            <%= image_tag post.image.url %>
                        <% end %>
                    <% end %><br>

                    下の選択肢から投票してください。<br>
                    <%= render 'posts/vote_form', post: post %>
                </div>
                <% end %>
            </div>
            <% else %>
            <p class="mb-10">まだ投稿がありません。</p>
        <% end %>

    </main>
    <%= render 'layouts/footer' %>

    <script>
        // 牌画像のリンクがクリックされた時、イベントの伝播を停止する
        document.addEventListener('click', function(event) {
            const target = event.target;
            if (target.classList.contains('tile-image')) {
                event.preventDefault(); // リンクのデフォルトの挙動をキャンセル
                event.stopPropagation(); // イベントの伝播を停止
                // ここでAjaxによる投票のリクエストを実行する
            }
        }, false);

        document.addEventListener('turbo:submit-end', (event) => {
            // スクロール位置を記録
            const scrollPosition = window.scrollY;

            requestAnimationFrame(() => {
            // スクロール位置を復元
            window.scrollTo({ top: scrollPosition, behavior: 'auto' });
            });
        });

    </script>

</body>
</html>
